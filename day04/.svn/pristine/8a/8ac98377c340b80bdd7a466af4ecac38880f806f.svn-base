var images={localId:[],serverId:[],imgflag:0};wx.ready(function(){$("#inputa").on("click",function(){wx.chooseImage({count:1,sizeType:["compressed"],sourceType:["camera"],success:function(res){images.localId[0]=res.localIds;var img=document.getElementById("showImg");img.src=images.localId[0];uploadImg()}})});function uploadImg(){setTimeout(function(){wx.uploadImage({localId:images.localId[0].toString(),isShowProgressTips:1,success:function(res){images.serverId[0]=res.serverId;ajaxImg()}})},100)}function ajaxImg(){$.ajax({url:"/InterFace/ValidateCenter/ValidateFamily02.ashx",type:"post",dataType:"json",cache:false,data:{"type":"uploadimg","type_detail":"0","serverId":images.serverId[0]},success:function(msg){if(msg.errmsg!="success"){errShow({"errmsg":"上传失败,请刷新重试.","errcode":""});images.imgflag=0;return}else{images.imgflag=1}}})}});function butSubmit(){if(images.imgflag==0){errShow({"errmsg":"请先上传图片.","errcode":""});return}window.location.href="/InterFace/ValidateCenter/ValidateFamily02.ashx?type=submit"}function errShow(obj){if(obj.errmsg||obj.errcode){$("#remind02 .motwo_wz").html(obj.errmsg);$("#remind02 .motwo_wz404").html("错误码:"+obj.errcode);$("#remind02").css("display","block");return false}return true}function showImg(){$.ajax({url:"/InterFace/ValidateCenter/ValidateFamily02.ashx",type:"post",dataType:"json",cache:false,data:{"type":"loadimgdata"},success:function(msg){var imglist=msg.IMGData;if(imglist.length>0){$("#showImg").attr("src",imglist[0].Img);images.imgflag=1}else{images.imgflag=0}}})};